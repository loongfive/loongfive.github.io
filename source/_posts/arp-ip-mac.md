title: "win7下绑定网关的ip和mac地址"
date: 2011-10-22 13:40:31
tags:
---

办公室的电脑装了win7之后有时侯莫名其妙的出现无法上网的现象，网络连接正常，显示有internet访问权限，获取的ip和网关都正常，但是上不了网，但是可以和局域网内的其它机器互访

之前出现过几次，还没来得及我深究，就莫名奇妙就好了

最近这边又多了几台win7的电脑，也遇到了这个问题，好吧，看来公司的网络不正常啊

最后各种查找原因，发现在 arp -a 的时候，网关ip对应的mac地址是不正确的，好吧，原来是arp攻击，赶紧把这个诡异的mac地址copy下来，以后慢慢查找元凶<!--more-->

07、08年那阵子还在学校，校园网里面arp病毒泛滥，对于我这个喜欢一切从简的人，杀毒软件可以不用，但那一阵arp防火墙是没敢省，也就是那个时候狠狠滴研究了一下arp。记得当时还有意外收获，通过arp欺骗，居然可以突破我们公寓区的VLAN，在不联网的情况我们几个不在一栋楼里的兄弟可以联机打CS ...

呃，上面是插曲

发现问题之后就是解决问题，只要把正确的mac地址绑定到网关的ip上就行了

赶紧滴 arp -s ... 居然不行，什么拒绝访问 ？？

网上搜一下，原来win7下arp -s是不行滴，但办法总是有滴，

先运行一下这个命令

netsh i i show in

可以查到网卡的序号，我的是11，后面命令会用到

下一条命令

netsh -c “i i” add neighbors 11 “网关IP” “Mac地址“

这里11是刚刚查到的网卡的那个序号。ok，搞定了!

arp -a 一下，发现mac地址已经是改过来的了，而且是静态的，至此问题解决 句号 谢谢

——————————————

当然，想我这么充满智慧的头脑，怎么会就此打住呢，总不能每个win7的系统都去手动绑定一下吧，这不是我的style啊

不过话说回来，这就不用我操心啦，我们基地有网管，不是我

这个诡异的mac地址到底是谁的呢？我们用的这条光纤接到网关，下面除了交换机还有几台无线路由器，然后有大概20多个用户，拓扑很简单啊

下了个nbtscan扫一下局域网里的mac地址

nbtscan -r 192.168.1.0/24

没有找到那个诡异的mac地址，可能那台主机有安全防护，nbtscan扫不出来，也可能是他下线了，也有可能，这个诡异的mac地址不是一台电脑，而是某个设备的

不过，这是病毒造成的arp欺骗吗？但是为什么只针对win7的系统呢，还是现在的病毒都进化到这个境界了？

唉，我这么多充满智慧的脑细胞也是有数量的，算了，不浪费了 ...

——————————————

ps. 哇，原来有半个月都没更新博客了，最近也不知道在忙些什么，感觉这个月过的很快

昨天转正答辩了，还算顺利，很感谢几位老大都很挺我